<script>
    var $viewer = document.getElementById("viewer");
    var $next = document.getElementById("next");
    var $prev = document.getElementById("prev");
    var currentSection;
    var currentSectionIndex = 6;

    var book = ePub("https://s3.amazonaws.com/epubjs/books/moby-dick/OPS/package.opf");
    book.loaded.navigation.then(function(toc){
      var $select = document.getElementById("toc"),
          docfrag = document.createDocumentFragment();

      toc.forEach(function(chapter) {
        var option = document.createElement("option");
        option.textContent = chapter.label;
        option.ref = chapter.href;

        docfrag.appendChild(option);
      });

      $select.appendChild(docfrag);

      $select.onchange = function(){
          var index = $select.selectedIndex,
              url = $select.options[index].ref;
          display(url);
          return false;
      };

      book.opened.then(function(){
        display(currentSectionIndex);
      });

      $next.addEventListener("click", function(){
        var displayed = display(currentSectionIndex+1);
        if(displayed) currentSectionIndex++;
      }, false);

      $prev.addEventListener("click", function(){
        var displayed = display(currentSectionIndex-1);
        if(displayed) currentSectionIndex--;
      }, false);

      function display(item){
        var section = book.spine.get(item);
        if(section) {
          currentSection = section;
          section.render().then(function(html){
            // $viewer.srcdoc = html;
            $viewer.innerHTML = html;
          });
        }
        return section;
      }

    });
  </script>

<script>
// Load the opf
var book = ePub("https://s3.amazonaws.com/epubjs/books/moby-dick/OPS/package.opf");
var rendition = book.renderTo("viewer", {
  manager: "continuous",
  flow: "paginated",
  width: "100%",
  height: "100%"
});

var displayed = rendition.display("chapter_001.xhtml");

displayed.then(function(renderer){
  // -- do stuff
});

// Navigation loaded
book.loaded.navigation.then(function(toc){
  // console.log(toc);
});

var next = document.getElementById("next");
next.addEventListener("click", function(){
  rendition.next();
}, false);

var prev = document.getElementById("prev");
prev.addEventListener("click", function(){
  rendition.prev();
}, false);

document.addEventListener("keyup", function(e){

  // Left Key
  if ((e.keyCode || e.which) == 37) {
    rendition.prev();
  }

  // Right Key
  if ((e.keyCode || e.which) == 39) {
    rendition.next();
  }

}, false);

$(window).on( "swipeleft", function( event ) {
  rendition.next();
});

$(window).on( "swiperight", function( event ) {
  rendition.prev();
});


</script>

<script>


var $ = document.querySelector.bind(document),
		eventName = $('#eventName'),
		currX = $('#currX'),
		currY = $('#currY'),
		distanceX = $('#distanceX'),
		distanceY = $('#distanceY'),
		test = $('#test'),
		preventDefault = function(e){e.preventDefault();};
test.addEventListener('tap',updateHtml);
test.addEventListener('dbltap',updateHtml);
test.addEventListener('longtap',updateHtml);
test.addEventListener('longtap',updateHtml);
test.addEventListener('swipeup',updateHtml);
test.addEventListener('swipedown',updateHtml);
test.addEventListener('swipeleft',updateHtml);
test.addEventListener('swiperight',updateHtml);
test.addEventListener('touchmove',preventDefault);
test.addEventListener('touchstart',preventDefault);
test.addEventListener('touchend',preventDefault);
function updateHtml (e){
	e.preventDefault();
	eventName.innerHTML = test.innerHTML =  e.type;
	currX.innerHTML = e.x;
	currY.innerHTML = e.y;
	distanceX.innerHTML = e.distance ? e.distance.x : 'not available';
	distanceY.innerHTML = e.distance ? e.distance.y : 'not available';
	return false;
}

</script>